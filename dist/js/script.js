window.onload=function(){document.body.classList.add("loaded_hiding"),window.setTimeout(function(){document.body.classList.add("loaded"),document.body.classList.remove("loaded_hiding")},500)};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new window.AudioContext}catch(e){console.log("No Web Audio API support")}const WebAudioAPISoundManager=function(e){this.context=e,this.bufferList={},this.playingSounds={}},WebAudioAPISound=(WebAudioAPISoundManager.prototype={addSound:function(t){var e=new XMLHttpRequest,n=(e.open("GET",t,!0),e.responseType="arraybuffer",this);e.onload=function(){n.context.decodeAudioData(e.response,function(e){e?n.bufferList[t]=e:console.log("error decoding file data: "+t)})},e.onerror=function(){console.log("BufferLoader: XHR error")},e.send()},stopSoundWithUrl:function(e){if(this.playingSounds.hasOwnProperty(e))for(var t in this.playingSounds[e])this.playingSounds[e].hasOwnProperty(t)&&this.playingSounds[e][t].stop()}},function(e){this.url=e+".mp3",window.webAudioAPISoundManager=window.webAudioAPISoundManager||new WebAudioAPISoundManager(window.audioContext),this.manager=window.webAudioAPISoundManager,this.manager.addSound(this.url)});WebAudioAPISound.prototype={play:function(e){var t,n=this.manager.bufferList[this.url];for(t in this.settings={loop:!1,volume:.5},e)e.hasOwnProperty(t)&&(this.settings[t]=e[t]);void 0!==n&&((n=this.makeSource(n)).loop=this.settings.loop,n.start(0),this.manager.playingSounds.hasOwnProperty(this.url)||(this.manager.playingSounds[this.url]=[]),this.manager.playingSounds[this.url].push(n))},stop:function(){this.manager.stopSoundWithUrl(this.url)},makeSource:function(e){var t=this.manager.context.createBufferSource(),n=this.manager.context.createGain();return n.gain.value=this.settings.volume,t.buffer=e,t.connect(n),n.connect(this.manager.context.destination),t}};let cyberSpeed=new Audio;cyberSpeed.preload="auto",cyberSpeed.src="sounds/cyberSpeed.mp3",cyberSpeed.volume=.25;const stepTetris=new WebAudioAPISound("sounds/stepTetris"),eatingTetris=new WebAudioAPISound("sounds/eatingTetris"),eatingCyber=new WebAudioAPISound("sounds/eatingCyber"),crashTetris=new WebAudioAPISound("sounds/crashTetris"),crashCyber=new WebAudioAPISound("sounds/crashCyber"),winTetris=new WebAudioAPISound("sounds/winTetris"),winCyberpunk=new WebAudioAPISound("sounds/winCyberpunk"),settingsChange=new WebAudioAPISound("sounds/settingsChange"),cyberBtnClick=new WebAudioAPISound("sounds/cyberBtnClick"),timerAudio=new WebAudioAPISound("sounds/timer"),clickAudio=new WebAudioAPISound("sounds/switch"),cyberPauseAudio=new WebAudioAPISound("sounds/cyberPause"),pauseAudio=new WebAudioAPISound("sounds/pause"),newRouteSound=new WebAudioAPISound("sounds/newRoute"),glitchAudio=new WebAudioAPISound("sounds/glitch"),hackAudio=new WebAudioAPISound("sounds/hack"),eggFind=new WebAudioAPISound("sounds/eggFind"),cyberpunkEgg=new WebAudioAPISound("sounds/cyberpunkEgg"),game={elements:{score:document.getElementById("scoreEl"),scoreValue:document.getElementById("score"),timer:document.getElementById("timer"),timerCount:document.getElementById("timerCount"),cyberBackground:document.getElementById("cyberBackground"),winText:document.getElementById("gameWinTextEl"),gameOverText:document.getElementById("gameOverTextEl"),field:document.getElementById("field"),td:document.getElementsByClassName("table__cell"),tr:document.getElementsByClassName("table__line"),settingsForm:document.getElementById("settingsForm"),cyberpunkEgg:document.getElementById("cyberpunkRange"),wakeUpText:document.getElementById("wakeUpTextEl"),hack:document.getElementById("hack"),hackText:document.getElementById("hackText"),reloadBtn:document.getElementById("reloadBtn"),settingsBtn:document.getElementById("settingsBtn"),settingsSaveBtn:document.getElementById("settingsSave"),touchBtnTop:document.getElementById("touchBtnTop"),touchBtnRight:document.getElementById("touchBtnRight"),touchBtnBottom:document.getElementById("touchBtnBottom"),touchBtnLeft:document.getElementById("touchBtnLeft"),touchControl:document.getElementById("touchControl"),dark:document.getElementById("dark"),timerDark:document.getElementById("timerDark")},sets:{steps:null,cyberBackground:null,hackPlay:null,wakeUpVisible:null,experiment:null},timer:{set:0,sec:3,add:function(){game.timer.sec--,game.timer.start()},start:function(){game.states.pause=!1,game.elements.timerCount.textContent=game.timer.sec,letterText(game.elements.timerCount,4,15),0==game.timer.sec?(game.timer.reset(),game.states.playing=!0,snake.move(),game.elements.dark.style.animationDuration=game.darkSec+"s",game.elements.dark.classList.add("field__dark_visible"),game.elements.timerDark.style.animationDuration=game.darkSec+"s",game.elements.timerDark.classList.add("timerDark_run")):(timerAudio.play({volume:.5}),game.elements.timer.classList.add("timer_start"),game.timer.set=setTimeout(game.timer.add,500))},reset:function(){clearTimeout(game.timer.set),game.elements.timer.classList.remove("timer_start"),game.timer.sec=3,game.elements.timerCount.textContent=game.timer.sec,game.elements.touchControl.classList.remove("touchControl_none"),1==game.states.pause?(game.elements.timer.classList.add("timer_start"),game.elements.timerCount.textContent="Пауза"):game.elements.timer.classList.remove("timer_start"),letterText(game.elements.timerCount,5,10)}},settings:{speed:"medium",theme:"tetris"},states:{playing:!1,pause:!1,gameOver:!0,gameWin:!1},count:0,speed:200,darkSec:3,start:function(){if(game.timer.start(),game.states.gameOver=!1,game.states.gameWin=!1,"tetris"==game.settings.theme)clearTimeout(game.sets.cyberBackground);else if("cyberpunk"==game.settings.theme){clearTimeout(game.sets.cyberBackground);let t=[];for(let e=0;e<3;e++)t.push(randomText(3,3e3,"lettersEng"));let e=2;game.sets.cyberBackground=setInterval(function(){e++,game.elements.cyberBackground.textContent=t[e%3]},1e3)}},stop:function(){0==game.states.pause&&(game.states.playing=!1),clearTimeout(game.sets.steps),clearTimeout(game.sets.hackPlay),clearTimeout(game.sets.wakeUpVisible),cyberpunkEgg.stop(),hackAudio.stop(),winCyberpunk.stop(),winTetris.stop(),game.timer.reset()},snakeDefault:function(){for(let e=0;e<game.elements.td.length;e++)game.elements.td[e].className="table__cell",game.elements.td[e].removeEventListener("click",egg),game.elements.td[e].hasAttribute("style")&&game.elements.td[e].removeAttribute("style");game.elements.td[0].classList.add("head"),"low"==game.settings.speed?game.darkSec=.35*playingField.numberOfCellsInOneRow:"medium"==game.settings.speed?game.darkSec=.3*playingField.numberOfCellsInOneRow:"high"==game.settings.speed&&(game.darkSec=.25*playingField.numberOfCellsInOneRow),snake.routeArray.length=0,game.elements.score.hasAttribute("style")&&game.elements.score.removeAttribute("style"),game.elements.hack.classList.contains("hack_animation")&&game.elements.hack.classList.remove("hack_animation"),game.elements.wakeUpText.classList.contains("info__wakeUpText_visible")&&game.elements.wakeUpText.classList.remove("info__wakeUpText_visible"),game.elements.field.classList.contains("field_bgBlack")&&game.elements.field.classList.remove("field_bgBlack"),game.elements.field.classList.contains("field_hack")&&game.elements.field.classList.remove("field_hack"),game.elements.field.classList.contains("field_image")&&game.elements.field.classList.remove("field_image"),game.elements.hack.hasAttribute("style")&&game.elements.hack.removeAttribute("style"),game.states.pause=!1,game.elements.gameOverText.classList.contains("info__overText_visible")&&game.elements.gameOverText.classList.remove("info__overText_visible"),game.elements.winText.classList.contains("info__winText_visible")&&game.elements.winText.classList.remove("info__winText_visible"),game.count=0,snake.long=0,snake.route="right",snake.newRoute=snake.route,game.elements.field.classList.contains("shake")&&game.elements.field.classList.remove("shake"),document.getElementById("wtf__text").textContent="";var e=document.getElementById("wtf"),t=document.getElementById("wtf__btn");eggClick=0,e.classList.contains("wtf_visible")&&e.classList.remove("wtf_visible"),t.classList.contains("wtf__btn_visible")&&t.classList.remove("wtf__btn_visible"),snake.headPosition=1,snake.nextHeadPosition=2,game.elements.cyberpunkEgg.classList.contains("cyberpunkRange_visible")&&game.elements.cyberpunkEgg.classList.remove("cyberpunkRange_visible"),game.elements.cyberpunkEgg.value=0,snake.history.length=0,game.scoreChange(),snake.apple=getRandomForApple(game.elements.td.length),game.elements.td[snake.apple].classList.add("apple"),game.elements.dark.classList.contains("field__dark_visible")&&game.elements.dark.classList.remove("field__dark_visible"),game.elements.timerDark.classList.contains("timerDark_run")&&game.elements.timerDark.classList.remove("timerDark_run")},over:function(){game.elements.gameOverText.classList.add("info__overText_visible"),"tetris"==game.settings.theme?(letterText(game.elements.gameOverText,3,25,!0),crashTetris.play({volume:.03}),game.elements.td[snake.headPosition-1].addEventListener("click",egg)):"cyberpunk"==game.settings.theme&&crashCyber.play({volume:.3}),game.elements.field.classList.add("shake"),game.elements.td[snake.headPosition-1].classList.add("crash");for(let e=0;e<snake.history.length;e++)game.elements.td[snake.history[e]].classList.add("crash");game.elements.cyberpunkEgg.classList.add("cyberpunkRange_visible"),game.states.gameOver=!0,game.stop(),game.elements.dark.classList.contains("field__dark_visible")&&game.elements.dark.classList.remove("field__dark_visible"),game.elements.timerDark.classList.contains("timerDark_run")&&game.elements.timerDark.classList.remove("timerDark_run"),game.elements.touchControl.classList.contains("touchControl_none")||game.elements.touchControl.classList.add("touchControl_none")},win:function(){game.elements.winText.classList.add("info__winText_visible"),"tetris"==game.settings.theme?(letterText(game.elements.winText,3,25,!0),winTetris.play({volume:.03,loop:!0})):"cyberpunk"==game.settings.theme&&winCyberpunk.play({volume:.2,loop:!0}),game.elements.td[snake.headPosition-1].classList.add("win"),snake.winAnimation(0),game.states.gameWin=!0,game.elements.dark.classList.contains("field__dark_visible")&&game.elements.dark.classList.remove("field__dark_visible"),game.elements.timerDark.classList.contains("timerDark_run")&&game.elements.timerDark.classList.remove("timerDark_run")},score:0,scoreChange:function(){let e;"low"==game.settings.speed?e=1:"medium"==game.settings.speed?e=2:"high"==game.settings.speed&&(e=3),game.score=10*snake.long*e,game.elements.scoreValue.textContent=Math.round(game.score),letterText2(game.elements.scoreValue,10,20)},checkKey:function(e){return["ArrowUp","ArrowRight","ArrowDown","ArrowLeft","KeyW","KeyD","KeyS","KeyA"].includes(e)}},playingField=((0<navigator.userAgent.toLowerCase().indexOf("firefox")||0<navigator.userAgent.toLowerCase().indexOf("mozilla"))&&(game.elements.touchControl.style.display="none",alert("Сенсорную управление недоступно, смените браузер.")),{numberOfCellsInOneRow:10,numberOfCellsInOneColumn:10,get totalNumberOfCells(){return this.numberOfCellsInOneRow*this.numberOfCellsInOneColumn},get fieldIndices(){var t=[];for(let e=0;e<playingField.totalNumberOfCells;e++)t.push(e);return t},removeTable:function(){var e=document.getElementsByClassName("table");e[0].parentNode.removeChild(e[0])},createPlayingField:function(t,n){var s=document.createElement("div");s.classList.add("table"),document.getElementById("playingField").appendChild(s);for(let e=0;e<t;e++){var a=document.createElement("div");a.classList.add("table__line"),s.appendChild(a);for(let e=0;e<n;e++){var i=document.createElement("div"),o=(i.classList.add("table__cell"),a.appendChild(i),document.createElement("span"));i.appendChild(o)}}},updateTable:function(n){var t=document.getElementsByClassName("table"),s=document.getElementsByClassName("table__line"),a=s[0].getElementsByClassName("table__cell");if(n!=s.length){console.log(s[0].children.length);for(let e=0;e<s[0].children.length;e++)s[0].children[e].className="table__cell";if(n>s.length){var i=n-s.length;for(let e=0;e<i;e++)t[0].appendChild(s[0].cloneNode(!0));var o=a.length;for(let t=0;t<s.length;t++)for(let e=0;e<n-o;e++)s[t].appendChild(a[0].cloneNode(!0))}else if(n<s.length){var l=s.length-n;for(let e=0;e<l;e++)t[0].removeChild(s[s.length-1]);var r=a.length;for(let t=0;t<s.length;t++)for(let e=0;e<r-n;e++){var m=s[t].getElementsByClassName("table__cell");s[t].removeChild(m[m.length-1])}}}},borders:{top:[],right:[],bottom:[],left:[]},bordersUpdate:function(){{let t=playingField.borders.top.length=0;for(let e=0;e<playingField.numberOfCellsInOneRow;e++)playingField.borders.top.push(t),t++}{playingField.borders.right.length=0;let t=playingField.numberOfCellsInOneRow-1;for(let e=0;e<playingField.numberOfCellsInOneColumn;e++)playingField.borders.right.push(t),t+=playingField.numberOfCellsInOneRow}{playingField.borders.bottom.length=0;let t=playingField.numberOfCellsInOneRow*(playingField.numberOfCellsInOneColumn-1);for(let e=0;e<playingField.numberOfCellsInOneRow;e++)playingField.borders.bottom.push(t),t++}{let t=playingField.borders.left.length=0;for(let e=0;e<playingField.numberOfCellsInOneColumn;e++)playingField.borders.left.push(t),t+=playingField.numberOfCellsInOneRow}}}),snake=(document.body.classList.add("tetris"),playingField.bordersUpdate(),{long:0,route:"right",newRoute:"right",routeArray:[],headPosition:1,nextHeadPosition:2,history:[],apple:void 0,clearTransition:function(){if(game.elements.td[snake.headPosition-1].removeAttribute("style"),0<snake.long)for(let e=0;e<snake.history.length;e++)game.elements.td[snake.history[e]].removeAttribute("style")},transition:function(){let e,t;if("left"==snake.route?(e=-game.elements.td[0].offsetWidth,t=0):"right"==snake.route?(e=game.elements.td[0].offsetWidth,t=0):"up"==snake.route?(e=0,t=-game.elements.td[0].offsetHeight):"down"==snake.route&&(e=0,t=game.elements.td[0].offsetHeight),game.elements.td[snake.headPosition-1].style.transition="transform "+game.speed/1e3+"s linear",game.elements.td[snake.headPosition-1].style.transform="translate3d("+e+"px, "+t+"px, 0)",0<snake.long){let a=500;for(let s=0;s<snake.history.length;s++){a--,game.elements.td[snake.history[s]].style.zIndex=a-s;let e,t,n;(n=0==s?snake.headPosition-1:snake.history[s-1])-snake.history[s]==-1?(e=-game.elements.td[0].offsetWidth,t=0):n-snake.history[s]==1?(e=game.elements.td[0].offsetWidth,t=0):n-snake.history[s]==-playingField.numberOfCellsInOneRow?(e=0,t=-game.elements.td[0].offsetHeight):n-snake.history[s]==playingField.numberOfCellsInOneRow&&(e=0,t=game.elements.td[0].offsetHeight),game.elements.td[snake.history[s]].style.transition="transform "+game.speed/1e3+"s linear",game.elements.td[snake.history[s]].style.transform="translate3d("+e+"px, "+t+"px, 0)"}}},updateHead:function(){game.elements.td[snake.headPosition-1].classList.remove("head"),snake.headPosition=snake.nextHeadPosition,game.elements.td[snake.headPosition-1].classList.add("head")},updateHistory:function(){0<snake.long&&(snake.history.unshift(snake.headPosition-1),game.elements.td[snake.history[0]].classList.add("body"),snake.history.length>snake.long&&(game.elements.td[snake.history[snake.history.length-1]].classList.remove("body"),snake.history.pop()))},newNextPosition:function(){snake.prevRoute=snake.route,snake.route=snake.newRoute,0<snake.routeArray.length&&(snake.route=snake.routeArray[0],snake.routeArray.shift()),"left"==snake.route?(gameOverCheck(playingField.borders.left),snake.nextHeadPosition=snake.headPosition-1,"cyberpunk"==game.settings.theme&&snake.prevRoute!=snake.route&&newRouteSound.play({volume:.2})):"right"==snake.route?(gameOverCheck(playingField.borders.right),snake.nextHeadPosition=snake.headPosition+1,"cyberpunk"==game.settings.theme&&snake.prevRoute!=snake.route&&newRouteSound.play({volume:.2})):"up"==snake.route?(gameOverCheck(playingField.borders.top),snake.nextHeadPosition=snake.headPosition-playingField.numberOfCellsInOneRow,"cyberpunk"==game.settings.theme&&snake.prevRoute!=snake.route&&newRouteSound.play({volume:.2})):"down"==snake.route&&(gameOverCheck(playingField.borders.bottom),snake.nextHeadPosition=snake.headPosition+playingField.numberOfCellsInOneRow,"cyberpunk"==game.settings.theme&&snake.prevRoute!=snake.route&&newRouteSound.play({volume:.2}))},move:function(){if(game.count++,"tetris"==game.settings.theme){if(snake.newNextPosition(),game.states.gameOver)return;if(gameOverCheck(snake.history,!0),game.states.gameOver)return;if(snake.updateHistory(),snake.updateHead(),stepTetris.play({volume:.005}),snake.eatingAnApple(),game.states.gameWin)return}else if("cyberpunk"==game.settings.theme){if(snake.clearTransition(),snake.eatingAnApple(),snake.updateHistory(),1!=game.count&&(snake.updateHead(),game.elements.td[snake.headPosition-1].style.zIndex=501),snake.newNextPosition(),game.states.gameOver)return;if(gameOverCheck(snake.history,!0),game.states.gameOver)return;if(snake.transition(),game.states.gameWin)return}game.sets.steps=setTimeout(function(){snake.move()},game.speed)},eatingAnApple:function(){if(snake.nextHeadPosition-1==snake.apple){"tetris"==game.settings.theme?(eatingTetris.stop(),eatingTetris.play({volume:.02})):"cyberpunk"==game.settings.theme&&(eatingCyber.stop(),eatingCyber.play({volume:.5})),snake.long++,game.darkSec=game.darkSec+.1,game.scoreChange(),game.elements.td[snake.apple].classList.remove("apple"),game.elements.td[snake.nextHeadPosition-1].classList.add("eating");let e=snake.nextHeadPosition-1;setTimeout(function(){game.elements.td[e].classList.remove("eating")},1e3),snake.apple=getRandomForApple(game.elements.td.length),1!=game.states.gameOver&&0!=game.states.playing&&(game.elements.td[snake.apple].classList.add("apple"),resetAnimation(game.elements.dark,"field__dark_visible"),game.elements.dark.style.animationDuration=game.darkSec+"s",game.elements.dark.classList.add("field__dark_visible"),resetAnimation(game.elements.timerDark,"timerDark_run"),game.elements.timerDark.style.animationDuration=game.darkSec+"s",game.elements.timerDark.classList.add("timerDark_run"))}},winAnimation:function(e){var t=1e3/playingField.totalNumberOfCells;game.elements.td[snake.headPosition-1].classList.add("win"),e<snake.history.length?(game.elements.td[snake.history[e]].classList.add("win"),e++,setTimeout(snake.winAnimation,t,e)):e=0}});function wakeUp(){for(let e=0;e<game.elements.td.length;e++)game.elements.td[e].style.transition="opacity 1s",game.elements.td[e].style.opacity=0,game.elements.score.style.display="none",game.elements.gameOverText.classList.remove("info__overText_visible");game.elements.hack.classList.add("hack_animation"),game.elements.hackText.textContent="(*&^#@)+_(^_)(#&@^)",letterText2(game.elements.hackText,190,25),game.elements.field.classList.add("field_bgBlack"),cyberpunkEgg.play({volume:.2}),game.sets.hackPlay=setTimeout(function(){game.elements.hackText.textContent="Взлом протокола_",progressiveShuffleAnimated(game.elements.hackText,4,25),hackAudio.play({volume:.3}),game.elements.field.classList.add("field_hack")},5e3)}game.elements.cyberpunkEgg.addEventListener("input",function(e){100==game.elements.cyberpunkEgg.value&&(eggFind.play({volume:.2}),game.elements.cyberpunkEgg.classList.remove("cyberpunkRange_visible"),wakeUp())}),game.elements.cyberBackground.addEventListener("transitionend",function(){game.elements.field.classList.add("field_image"),game.elements.hack.style.opacity=0,game.sets.wakeUpVisible=setTimeout(function(){game.elements.wakeUpText.classList.add("info__wakeUpText_visible")},3500)});let eggClick=0;function egg(){if(0!=game.states.gameOver||"tetris"==game.settings.theme){let e=document.getElementById("wtf"),t=document.getElementById("wtf__text"),n=document.getElementById("wtf__btn"),s,a;switch(++eggClick){case 5:s="Зачем ты по мне кликаешь?",a="Ты кто?",n.onclick=function(){e.classList.remove("wtf_visible"),n.classList.remove("wtf__btn_visible")};break;case 10:s="Не делай этого, мне не нравится.",a="Ладно";break;case 15:s="Хватит.",a="Ха!";break;case 20:s="Тебе больше нечего делать?",a="А тебе?";break;case 25:s="Тут нужно в змейку играть, а не меня доставать.",a="Я знаю";break;case 30:s="Ну правда, прекращай.",a="А что мне за это будет?";break;case 35:s="Ладно, я просто буду тебя игнорировать.",a="Стой!";break;case 50:s="Палец не устал еще?",a="Неа :)";break;case 55:s="Ты по мне кликнул уже 55 раз.",a="Могу ещё столько же";break;case 50:s="Удивительно, насколько человек способен прожигать своё время в никуда.",a="Это весело :)";break;case 55:s="А знаешь, я уже привык к твоим тыканьям.",a="Тык тык тык";break;case 60:s="Проведем эксперимент. Посмотрим как ты себя поведешь. Я указываю тебе: БОЛЬШЕ НЕ НАЖИМАЙ НА МЕНЯ.",a="Хм...",n.onclick=function(){e.classList.remove("wtf_visible"),n.classList.remove("wtf__btn_visible"),game.sets.experiment=setTimeout(function(){experimentFunc(e,t,n)},1e4),n.onclick=function(){e.classList.remove("wtf_visible"),n.classList.remove("wtf__btn_visible")}},eggClick++;break;case 62:clearTimeout(game.sets.experiment),s="Вот видишь как тобой легко управлять. Достаточно лишь сказать что делать и ты поступишь ровно наоборот. :)",a="Не правда!";break;case 67:s="С меня хватит, я ухожу.",a="Эй подожди!",game.elements.td[snake.headPosition-1].removeEventListener("click",egg),game.elements.td[snake.headPosition-1].classList.remove("head","crash"),game.elements.td[snake.apple].addEventListener("click",egg);for(let e=0;e<snake.history.length;e++)void 0!==game.elements.td[snake.history[e]]&&game.elements.td[snake.history[e]].classList.remove("body","crash");break;case 68:s="Теперь и меня решил подоставать? Я просто яблоко.",a="Ням ням",game.elements.td[snake.apple].removeEventListener("click",egg),game.elements.td[snake.apple].classList.remove("apple");break;default:s=!1}s&&(e.classList.add("wtf_visible"),t.textContent=s,n.textContent=a,letterText(t,3,10,!0,function(){n.classList.add("wtf__btn_visible")}))}}function experimentFunc(e,t,n){e.classList.add("wtf_visible"),t.textContent="Вот видишь как тобой легко управлять. :)",n.textContent="Не правда!",letterText(t,3,10,!0,function(){n.classList.add("wtf__btn_visible")}),eggClick+=2,clearTimeout(game.sets.experiment)}const textAnimation=function(e,t,n){"tetris"==game.settings.theme&&((e=document.getElementById(e)).textContent=t,progressiveShuffleAnimated(e,n,50))};function submitForm(e){e.preventDefault()}game.elements.settingsBtn.onclick=function(){var e=document.getElementById("settingsPage");"tetris"==game.settings.theme?clickAudio.play({volume:.2}):"cyberpunk"==game.settings.theme&&cyberBtnClick.play({volume:.3}),game.stop(),e.classList.add("settings_open"),game.elements.reloadBtn.setAttribute("tabindex","-1"),game.elements.settingsBtn.setAttribute("tabindex","-1"),game.elements.touchControl.classList.add("touchControl_none"),glitchAudio.stop()},game.elements.reloadBtn.onclick=function(){"tetris"==game.settings.theme?clickAudio.play({volume:.2}):"cyberpunk"==game.settings.theme&&cyberBtnClick.play({volume:.3}),game.stop(),game.snakeDefault(),game.start(),glitchAudio.stop()},game.elements.reloadBtn.addEventListener("mouseenter",function(e){textAnimation("reloadBtnText","Старт",2),"cyberpunk"==game.settings.theme&&glitchAudio.play({volume:.035,loop:!0})},!1),game.elements.reloadBtn.addEventListener("mouseleave",function(e){glitchAudio.stop()},!1),game.elements.reloadBtn.onfocus=function(){textAnimation("reloadBtnText","Старт",2)},game.elements.settingsBtn.addEventListener("mouseenter",function(e){textAnimation("settingsBtnText","Настройки",1),"cyberpunk"==game.settings.theme&&glitchAudio.play({volume:.035,loop:!0})},!1),game.elements.settingsBtn.addEventListener("mouseleave",function(e){glitchAudio.stop()},!1),game.elements.settingsBtn.onfocus=function(){textAnimation("settingsBtnText","Настройки",1)},game.elements.settingsSaveBtn.addEventListener("mouseenter",function(e){textAnimation("settingsSaveBtnText","Сохранить",1),"cyberpunk"==game.settings.theme&&glitchAudio.play({volume:.035,loop:!0})},!1),game.elements.settingsSaveBtn.addEventListener("mouseleave",function(e){glitchAudio.stop()},!1),game.elements.settingsSaveBtn.onfocus=function(){textAnimation("settingsSaveBtnText","Сохранить",1)},game.elements.settingsSaveBtn.onclick=function(){var e=document.getElementById("settingsPage"),t=Number(document.querySelector('input[name="fieldSize"]:checked').value),n=document.querySelector('input[name="speed"]:checked').value,s=document.querySelector('input[name="theme"]:checked').value;"low"==n?game.speed=250:"medium"==n?game.speed=200:"high"==n&&(game.speed=150),game.settings.speed=n,game.settings.theme=s,document.body.classList.remove("tetris","cyberpunk"),document.body.classList.add(s),playingField.updateTable(t),playingField.numberOfCellsInOneRow=t,playingField.numberOfCellsInOneColumn=t,playingField.bordersUpdate(),e.classList.remove("settings_open"),game.snakeDefault(),game.start(),"tetris"==game.settings.theme?clickAudio.play({volume:.2}):"cyberpunk"==game.settings.theme&&cyberBtnClick.play({volume:.3}),game.elements.reloadBtn.setAttribute("tabindex","0"),game.elements.settingsBtn.setAttribute("tabindex","0"),game.elements.touchControl.classList.remove("touchControl_none"),glitchAudio.stop()},game.elements.settingsForm.addEventListener("change",function(){("tetris"==game.settings.theme||"cyberpunk"==game.settings.theme)&&settingsChange.play({volume:.2})}),game.elements.touchControl.onmousedown=function(e){newRouteFunc(e.target.value),boostSpeed(e.target.value),e.target.classList.contains("touch")||e.target.classList.add("touch")},game.elements.touchControl.ontouchstart=function(e){e.preventDefault(),e.stopPropagation(),newRouteFunc(e.target.value),boostSpeed(e.target.value),e.target.classList.contains("touch")||e.target.classList.add("touch")},game.elements.touchControl.onmouseup=function(e){boostSpeedReset(),e.target.classList.contains("touch")&&e.target.classList.remove("touch")},game.elements.touchControl.ontouchend=function(e){e.preventDefault(),e.stopPropagation(),boostSpeedReset(),e.target.classList.contains("touch")&&e.target.classList.remove("touch")},document.addEventListener("keydown",function(e){var t=e.code;newRouteFunc(t),boostSpeed(t),e.stopPropagation()}),document.addEventListener("keyup",function(e){boostSpeedReset(),e.stopPropagation()});const newRouteWrapFunc=function(){let n;return function(t){if("Escape"==t||"KeyP"==t||"Pause"==t)if(0==game.states.pause){if(0==game.states.playing)return;"tetris"==game.settings.theme?pauseAudio.play({volume:.4}):"cyberpunk"==game.settings.theme&&cyberPauseAudio.play({volume:.4}),game.states.pause=!0,game.states.playing=!1,game.timer.reset(),game.stop(),snake.routeArray.length=0}else game.states.pause=!1,game.start();if(game.checkKey(t)&&0!=game.states.playing&&1!=game.states.pause){let e;if(n!=game.count&&(snake.routeArray.length=0),e=0==snake.routeArray.length?snake.route:snake.routeArray[snake.routeArray.length-1],"ArrowUp"==t||"KeyW"==t){if("down"==e||"up"==e)return;snake.newRoute="up"}else if("ArrowRight"==t||"KeyD"==t){if("left"==e||"right"==e)return;snake.newRoute="right"}else if("ArrowDown"==t||"KeyS"==t){if("up"==e||"down"==e)return;snake.newRoute="down"}else if("ArrowLeft"==t||"KeyA"==t){if("right"==e||"left"==e)return;snake.newRoute="left"}snake.routeArray.push(snake.newRoute),n=game.count}}},newRouteFunc=newRouteWrapFunc();function boostSpeed(e){game.states.playing&&("ArrowUp"==e||"KeyW"==e?"up"==snake.route&&(game.speed=100,"cyberpunk"==game.settings.theme&&cyberSpeed.play()):"ArrowRight"==e||"KeyD"==e?"right"==snake.route&&(game.speed=100,"cyberpunk"==game.settings.theme&&cyberSpeed.play()):"ArrowDown"==e||"KeyS"==e?"down"==snake.route&&(game.speed=100,"cyberpunk"==game.settings.theme&&cyberSpeed.play()):"ArrowLeft"!=e&&"KeyA"!=e||"left"==snake.route&&(game.speed=100,"cyberpunk"==game.settings.theme&&cyberSpeed.play()))}function boostSpeedReset(){"low"==game.settings.speed?game.speed=250:"medium"==game.settings.speed?game.speed=200:"high"==game.settings.speed&&(game.speed=150),"cyberpunk"==game.settings.theme&&(cyberSpeed.pause(),cyberSpeed.currentTime=0)}function gameOverCheck(t,n){if(0!=t.length){let e;n&&(e=t[t.length-1],t.pop()),t.includes(snake.nextHeadPosition-1)?(n&&t.push(e),game.over(),"cyberpunk"==game.settings.theme&&(cyberSpeed.pause(),cyberSpeed.currentTime=0)):n&&t.push(e)}}function getRandomForApple(e){let t;var n;if((t="cyberpunk"==game.settings.theme?snake.history.length+1:snake.history.length)!=playingField.totalNumberOfCells-1)return(n=playingField.fieldIndices.filter(function(e,t,n){return!snake.history.includes(e)&&e!=snake.headPosition-1&&e!=snake.nextHeadPosition-1}))[Math.floor(Math.random()*n.length)];game.stop(),game.win()}function letterText2(t,n,s){let a=t.textContent;!function e(){t.textContent=randomText(a.length,1,whatIsTheSymbol(a.charAt(0)));n--;0==n?t.textContent=a:setTimeout(function(){e()},s)}(),n++}function randomText(n,e,s){let a="",i="";for(let t=0;t<e;t++){for(let e=0;e<n;e++)30==t?i="DMX":i+=pass_gen(1,s);a=a+i+" ",i=""}return a}function letterText(o,e,l,r,m){let g,d=(r&&((g=new Audio).preload="auto",g.src="sounds/keyboard.mp3",g.volume=.2,g.play()),o.textContent);o.textContent="";var t=[];for(let e=0;e<d.length;e++)t.push(d.charAt(e));let u=-1;!function n(){u++;let s=d.substr(0,u);let a=e+1;i();function i(){let e=whatIsTheSymbol(d.charAt(u)),t=pass_gen(1,e);d.charAt(u)==d.charAt(u).toLowerCase()&&(t=t.toLowerCase()),0!=--a?setTimeout(function(){o.textContent=s+t.charAt(0),s.length==d.length?(o.textContent=s,r&&(g.pause(),g.currentTime=0),m&&m()):i()},l):(0!=s.length&&(o.textContent=s+t.charAt(0)),n())}}()}function whatIsTheSymbol(e){return/[a-zA-Z]/.test(e)?"lettersEng":/[а-яА-Я]/.test(e)?"lettersRus":/[0-9]/.test(e)?"numbers":"otherSymbols"}function pass_gen(t,e){var n;let s,a=(s="lettersRus"==e?"АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ":"lettersEng"==e?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":"numbers"==e?"0123456789":"!@#$%^&*()_+=-№;?.,/><|}{","");for(let e=0;e<t;e++)n=Math.floor(Math.random()*s.length),a+=s.substring(n,n+1);return a}function progressiveShuffleAnimated(s,a,i){let o=s.textContent,l=[];for(let e=0;e<o.length;e++)l.push(o.charAt(e));let r="",m=l.slice(),g=-1;!function e(){-1!=g&&(r+=l[g],m.shift());g++;let t=a+1;i*=1.1;n();function n(){s.textContent=getShuffleWord(r,m),0!=--t?setTimeout(function(){n()},i):g==o.length-1?setTimeout(function(){shuffleBug(l,s,o)},200):e()}}()}function getShuffleWord(e,t){var n=t.slice();for(let e=n.length-1;0<e;e--){var s=Math.floor(Math.random()*(e+1));[n[e],n[s]]=[n[s],n[e]]}let a="";for(let e=0;e<n.length;e++)a+=n[e];return a=e+a}function shuffleBug(e,t,n){var s=e.slice(),a=Math.floor(Math.random()*e.length);let i,o=!1;for(;0==o;)a!=(i=Math.floor(Math.random()*e.length))&&(o=!0);[s[i],s[a]]=[s[a],s[i]];let l="";for(let e=0;e<s.length;e++)l+=s[e];t.textContent=l,setTimeout(function(){t.textContent=n},70)}function resetAnimation(e,t){e.classList.remove(t),e.style.animation="none",e.offsetHeight,e.style.animation=null}